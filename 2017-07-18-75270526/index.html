<!DOCTYPE html>
<html>
<head hexo-theme="https://volantis.js.org/#2.6.6">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客</title>
  
    <meta name="keywords" content="CSDN">
  
  
    <meta name="description" content="[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://b...">
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="tabris的博客">
  

  <!-- import meta -->
  
    
      <meta name="theme-color" content="#FFFFFF">
    
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  
  
  <link rel="shortcut icon" type="image/x-icon" sizes="16x16 32x32 48x48 64x64" href="/assets/favicon/favicon.ico">
  <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/favicon/favicon_180.png">
  <link rel="mask-icon" color="#1BC3FB" href="/assets/favicon/favicon_180.png">
  <link rel="manifest" href="/manifest.json">
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">
  <div class="container">
  <div class="wrapper">
    <div class="nav-sub">
      <p class="title"></p>
      <ul class="switcher nav-list-h">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href="javascript:void(0)"></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href="javascript:void(0)"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href="/">
          
          
            <i class="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg"></i>
          
          
            Tabris
          
          
        </a>
      

			<div class="menu navigation">
				<ul class="nav-list-h">
          
          
          
            
            
              <li>
                <a class="flat-box" href="/" id="home">
                  <i class="fas fa-home fa-fw"></i>首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box">
                  <i class="fas fa-book fa-fw"></i>待整理
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="搜索...">
        </form>
      </div>

			<ul class="switcher nav-list-h">
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href="javascript:void(0)"></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href="javascript:void(0)"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href="/" id="home">
                  <i class="fas fa-home fa-fw"></i>首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box">
                  <i class="fas fa-book fa-fw"></i>待整理
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class="body-wrapper">
      

<div class="l_main">
  

  
    <article id="post" class="post white-box reveal shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class="meta">
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h1 class="title">
    <a href="/2017-07-18-75270526/">
      [原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
    </a>
  </h1>


        
        <div class="new-meta-box">
          
            
          
            
              
<div class="new-meta-item author">
  <a href rel="nofollow">
    <img src>
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class="new-meta-item category">
    <a href="/categories/csdn/%E5%88%86%E6%B2%BB/spoj/" rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>CSDN/分治/SPOJ</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2017年7月18日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item wordcount">
    <a class="notlink">
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：1.6k字</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class="notlink">
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：8分钟</p>
    </a>
  </div>


            
          
            
              
  <div class="new-meta-item browse valine">
    <a class="notlink">
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      
      <span id="/2017-07-18-75270526/" class="leancloud_visitors" data-flag-title="[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <p>[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】</p>
<p>2017-07-18 09:10:38  <a href="https://me.csdn.net/qq_33184171" target="_blank" rel="external nofollow noopener noreferrer">Tabris_</a> 阅读数：892</p>
<hr>
<p>博客爬取于<code>2020-06-14 22:39:37</code><br><strong><em>以下为正文</em></strong></p>
<p>版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。<br><a href="https://blog.csdn.net/qq_33184171/article/details/75270526" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/qq_33184171/article/details/75270526</a></p>
<a id="more"></a>

<hr>
<p>题目链接：<a href="http://www.spoj.com/problems/FTOUR2/" target="_blank" rel="external nofollow noopener noreferrer">http://www.spoj.com/problems/FTOUR2/</a><br>—————————————————————————————————————<br>FTOUR2 - Free tour II<br>no tags<br>After the success of 2nd anniversary (take a look at problem FTOUR for more details), this 3rd year, Travel Agent SPOJ goes on with another discount tour.</p>
<p>The tour will be held on ICPC island, a miraculous one on the Pacific Ocean. We list N places (indexed from 1 to N) where the visitors can have a trip. Each road connecting them has an interest value, and this value can be negative (if there is nothing interesting to view there). Simply, these N places along with the roads connecting them form a tree structure. We will choose two places as the departure and destination of the tour.</p>
<p>Since September is the festival season of local inhabitants, some places are extremely crowded (we call them crowded places). Therefore, the organizer of the excursion hopes the tour will visit at most K crowded places (too tiring to visit many of them) and of course, the total number of interesting value should be maximum.</p>
<p>Briefly, you are given a map of N places, an integer K, and M id numbers of crowded place. Please help us to find the optimal tour. Note that we can visit each place only once (or our customers easily feel bored), also the departure and destination places don&#39;t need to be different.</p>
<p>Input</p>
<p>There is exactly one case. First one line, containing 3 integers N K M, with 1 &lt;= N &lt;= 200000, 0 &lt;= K &lt;= M, 0 &lt;= M &lt;= N.</p>
<p>Next M lines, each line includes an id number of a crowded place.</p>
<p>The last (N - 1) lines describe (N - 1) two-way roads connected N places, form a b i, with a, b is the id of 2 places, and i is its interest value (-10000 &lt;= i &lt;= 10000).</p>
<p>Output</p>
<p>Only one number, the maximum total interest value we can obtain.</p>
<p>Example</p>
<p>Input:<br>8 2 3<br>3<br>5<br>7<br>1 3 1<br>2 3 10<br>3 4 -2<br>4 5 -1<br>5 7 6<br>5 6 5<br>4 8 3</p>
<p>Output:<br>12<br>Explanation</p>
<p>We choose 2 and 6 as the departure and destination place, so the tour will be 2 -&gt; 3 -&gt; 4 -&gt; 5 -&gt; 6, total interest value = 10 + (-2) + (-1) + 5 = 12 </p>
<ul>
<li>Added some unofficial cases<br>——————————————————————————————————————</li>
</ul>
<p>题目大意：<br>给你一棵树，树上的节点有白点有黑点，其中找到一条路径使得在经过的黑色点数<strong>不超过K</strong>的时候 路径长度最大，输出这个最大值</p>
<hr>
<h2 id="最好去看论文-gt-戳这里"><a href="#最好去看论文-gt-戳这里" class="headerlink" title="最好去看论文===&gt;戳这里"></a><strong>最好去看论文===&gt;<a href="https://wenku.baidu.com/view/e932a21614791711cc791725.html" target="_blank" rel="external nofollow noopener noreferrer">戳这里</a></strong></h2><p><strong>注意! 注意!  这里最小值要初始化为0,而不是-INF,可以路径上只有一个点.....wa到死有没有!!!</strong></p>
<p>还是采用点分治,</p>
<p>首先 对于每个子树 找 经过根节点的 满足条件 最大值</p>
<p>可以想到在遍历子树的时候<br>维护一个$mx[i]$ 记录当前节点到根节点经过i个【黑】点时的距离<br>处理出一个前缀最大值  然后就能O(k/2)的计算 当前最大值</p>
<p>但是问题时如何 避免以根节点儿子为根的子树中的不满足的值</p>
<p>笨想就是 枚举两个子树 然后维护，但显然这部分复杂度是$O(n^2)$的</p>
<p>然后就像 其实对一个子树来说 就是要找它和除这个子树外的其他子树的最大值的和</p>
<p>对于n个子树来说 直接将前i-1的结果个合并,<br>然后就能直接维护第i个子树的答案了</p>
<p>然后这部分操作 $O([u].size()*k)$</p>
<p>然后采用优化策略 只有,找到对每个以根节点儿子为根的子树中 经过最多的黑色点的路径中黑色点数为A,由于A大于K的地方对结果无贡献,就不用计算了, 这里算一个剪枝.</p>
<p>然后对前i-1个结果合并的时候 采取启发式合并,先合并小的,在合并大的,这样的话 维护下来 $mx[i]$ 中$i$的上届会递增,能够优化.</p>
<p>最后总复杂度就是$O(n\log n)$ [详细复杂度分析请移步国家队论文↑]</p>
<p>附本题代码<br>——————————————————————————————————————</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">include</span> &lt;bits/stdc++.h&gt;</span><br><span class="line">typedef long long <span class="type">int</span> LL;</span><br><span class="line"><span class="keyword">using</span> namespace std;</span><br><span class="line"></span><br><span class="line">const <span class="type">int</span> N = <span class="number">200000</span>+<span class="number">7</span>;</span><br><span class="line">const <span class="type">int</span> INF = (~(<span class="number">1</span>&lt;&lt;<span class="number">31</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">int</span> <span class="keyword">read</span>()&#123;</span><br><span class="line">    <span class="type">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="type">char</span> ch = getchar();</span><br><span class="line">    <span class="keyword">for</span>(;ch&lt;<span class="string">'0'</span>||<span class="string">'9'</span>&lt;ch;ch=getchar()) <span class="keyword">if</span>(ch==<span class="string">'-'</span>) f=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="string">'0'</span>&lt;=ch&amp;&amp;ch&lt;=<span class="string">'9'</span>;ch=getchar()) x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+ch-<span class="string">'0'</span>;</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,k,m,ans;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="type">int</span> black[N];</span><br><span class="line"></span><br><span class="line">struct edge&#123;</span><br><span class="line">    <span class="type">int</span> <span class="keyword">to</span>,next;</span><br><span class="line">    <span class="type">int</span> w;</span><br><span class="line">&#125;G[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> head[N],tot;</span><br><span class="line"><span class="type">void</span> <span class="keyword">add</span>(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w=<span class="number">0</span>)&#123;</span><br><span class="line">    G[tot].w=w,G[tot].<span class="keyword">to</span>=v,G[tot].next=head[u],head[u]=tot++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********重心 begin********/</span></span><br><span class="line"><span class="type">int</span> sz[N],dn[N],siz,zx;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> getzx(<span class="type">int</span> u,<span class="type">int</span> fa=<span class="number">0</span>)&#123;</span><br><span class="line">    sz[u]=<span class="number">1</span>;dn[u]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u],<span class="keyword">to</span>;i!=<span class="number">-1</span>;i=G[i].next)&#123;</span><br><span class="line">        <span class="keyword">to</span> = G[i].<span class="keyword">to</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">to</span> == fa||vis[<span class="keyword">to</span>]) <span class="keyword">continue</span>;//puts("---+++---");</span><br><span class="line">        getzx(<span class="keyword">to</span>,u);</span><br><span class="line">        sz[u]+=sz[<span class="keyword">to</span>];</span><br><span class="line">        dn[u]=max(dn[u],sz[<span class="keyword">to</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    dn[u]=max(dn[u],siz-sz[u]);</span><br><span class="line">    <span class="keyword">if</span>(dn[u]&lt;dn[zx]) zx=u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*********重心 end********/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dep[N],dis[N],deep_mx;</span><br><span class="line"><span class="type">void</span> getdis(<span class="type">int</span> u,<span class="type">int</span> fa=<span class="number">0</span>)&#123;</span><br><span class="line">    deep_mx=max(deep_mx,dep[u]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u],<span class="keyword">to</span>;i!=<span class="number">-1</span>;i=G[i].next)&#123;</span><br><span class="line">        <span class="keyword">to</span> = G[i].<span class="keyword">to</span>;</span><br><span class="line">        <span class="keyword">if</span>(vis[<span class="keyword">to</span>]||<span class="keyword">to</span>==fa)<span class="keyword">continue</span>;</span><br><span class="line">        dep[<span class="keyword">to</span>]=dep[u]+black[<span class="keyword">to</span>];</span><br><span class="line">        dis[<span class="keyword">to</span>]=dis[u]+G[i].w;</span><br><span class="line">        getdis(<span class="keyword">to</span>,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> tmp[N],mx[N];</span><br><span class="line"><span class="type">void</span> getmx(<span class="type">int</span> u,<span class="type">int</span> fa=<span class="number">0</span>)&#123;</span><br><span class="line">    tmp[dep[u]]=max(tmp[dep[u]],dis[u]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u],<span class="keyword">to</span>;i;i=G[i].next)&#123;</span><br><span class="line">        <span class="keyword">to</span> = G[i].<span class="keyword">to</span>;</span><br><span class="line">        <span class="keyword">if</span>(vis[<span class="keyword">to</span>]||<span class="keyword">to</span>==fa)<span class="keyword">continue</span>;</span><br><span class="line">        getmx(<span class="keyword">to</span>,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; &gt;v;</span><br><span class="line"><span class="type">void</span> solve(<span class="type">int</span> u)&#123;</span><br><span class="line">    vis[u]=<span class="number">1</span>;<span class="keyword">if</span>(black[u]) k<span class="comment">--; v.clear();</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u],<span class="keyword">to</span>;i!=<span class="number">-1</span>;i=G[i].next)&#123;</span><br><span class="line">        <span class="keyword">to</span>=G[i].<span class="keyword">to</span>; <span class="keyword">if</span>(vis[<span class="keyword">to</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        deep_mx = <span class="number">0</span>;</span><br><span class="line">        dep[<span class="keyword">to</span>]=black[<span class="keyword">to</span>];</span><br><span class="line">        dis[<span class="keyword">to</span>]=G[i].w;</span><br><span class="line">        getdis(<span class="keyword">to</span>,u);</span><br><span class="line">        v.push_back(make_pair(deep_mx,<span class="keyword">to</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sort(v.<span class="keyword">begin</span>(),v.<span class="keyword">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,now;i&lt;v.size();i++)&#123;</span><br><span class="line">        getmx(v[i].second,u);</span><br><span class="line">        now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(i)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=v[i].first;j&gt;=<span class="number">0</span>;j<span class="comment">--)&#123;</span></span><br><span class="line">                <span class="keyword">while</span>(now+j&lt;k&amp;&amp;now&lt;v[i<span class="number">-1</span>].first)</span><br><span class="line">                    now++,mx[now]=max(mx[now],mx[now<span class="number">-1</span>]);</span><br><span class="line">                <span class="keyword">if</span>(now+j&lt;=k) ans=max(ans,mx[now]+tmp[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i==v.size()<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=v[i].first;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j&lt;=k) ans = max(max(tmp[j],mx[j]),ans);</span><br><span class="line">                tmp[j]=mx[j]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=v[i].first;j++)</span><br><span class="line">                mx[j]=max(mx[j],tmp[j]),tmp[j]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(black[u])k++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=head[u],<span class="keyword">to</span>;i!=<span class="number">-1</span>;i=G[i].next)&#123;</span><br><span class="line">        <span class="keyword">to</span>=G[i].<span class="keyword">to</span>;</span><br><span class="line">        <span class="keyword">if</span>(vis[<span class="keyword">to</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        siz=sz[<span class="keyword">to</span>],zx=<span class="number">0</span>;getzx(<span class="keyword">to</span>);</span><br><span class="line">        solve(zx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> main()&#123;</span><br><span class="line">    memset(head,<span class="number">-1</span>,sizeof(head));</span><br><span class="line">   zx=<span class="number">0</span>;  tot = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    n=<span class="keyword">read</span>(),k=<span class="keyword">read</span>(),m=<span class="keyword">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++) black[<span class="keyword">read</span>()]=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,u,v,w;i&lt;n;i++)&#123;</span><br><span class="line">        u=<span class="keyword">read</span>(),v=<span class="keyword">read</span>(),w=<span class="keyword">read</span>();</span><br><span class="line">        <span class="keyword">add</span>(u,v,w);<span class="keyword">add</span>(v,u,w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dn[<span class="number">0</span>]=n;</span><br><span class="line">    siz = n; getzx(<span class="number">1</span>);</span><br><span class="line">//    printf("tot = %d zx = %d\n",tot,zx);</span><br><span class="line">//    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">//        printf("dn[%d] = %d sz[%d] = %d\n",i,dn[i],i,sz[i]);</span><br><span class="line"></span><br><span class="line">    ans = <span class="number">0</span>; solve(zx);</span><br><span class="line"></span><br><span class="line">    printf("%d\n",ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
            <div class="article_footer">
              
                
  
    
    

<section class="widget copyright  desktop mobile">
  <div class="content">
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href="http://tabris.top/2017-07-18-75270526/">http://tabris.top/2017-07-18-75270526/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class="content article-entry">
    
      
        <div class="fancybox"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/qrcode/wechat.jpg" height="64px"></div>
      
    
      
        <div class="fancybox"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/qrcode/alipay.jpg" height="64px"></div>
      
    
  </div>
</section>

  


              
            </div>
          
        </div>
        
          


  <section class="meta" id="footer-meta">
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-06-19T13:14:24+00:00">
  <a class="notlink">
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020年6月19日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/csdn/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>CSDN</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title rel="external nofollow noopener noreferrer" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tabris.top/2017-07-18-75270526/&title=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客&summary=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/75270526" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title rel="external nofollow noopener noreferrer" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://tabris.top/2017-07-18-75270526/&title=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客&summary=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/75270526" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title rel="external nofollow noopener noreferrer" href="http://service.weibo.com/share/share.php?url=http://tabris.top/2017-07-18-75270526/&title=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客&summary=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】
2017-07-18 09:10:38  Tabris_ 阅读数：892

博客爬取于2020-06-14 22:39:37以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/75270526" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
      
        
        <div class="hoverbox">
          <a><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/wechat.png"></a>
          <div class="target">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAAAAACi5bZQAAAC+klEQVR42u3aO3LDMAwFQN//0k6fiUb4yRHkZeeElslV8wbA6239uV4IwIABAwYMmDUwr+I6fPDB/8++//vv0d85+l71PmDAgAEDBgyYfTDhADQEEwWPvpCp+4ABAwYMGDBg9sKcBqCT/VNBLBoAs+c73Q8GDBgwYMCA+TqYqc/ZAhYYMGDAgAEDBswUzFRBK9toAwMGDBgwYMCASTeohtd0wPu3TiQYMGDAgAED5mMw1Qvc9XP5PmDAgAEDBgyYNTDdVS0MTQXL9/ACAwYMGDBgwOyBqQakKtRV+8bODwYMGDBgwIBZA1M9wFUNsWgwnAYDAwYMGDBgwOyFqRaeqgWo6KDQ1S8qXMEDAwYMGDBgwNwWZiqofarhdlXhCgwYMGDAgAGzFyZ6sWyhqQtQPWf2HmDAgAEDBgyY58BUL9ZtfGUbcF1YMGDAgAEDBszzYKYGeLoNue7AUHg/GDBgwIABA+YxMN2C1FWNu2ygC+8HAwYMGDBgwKyBqQajboEp+tzqOaqwYMCAAQMGDJg9MFcNAFUbcdXgli1ohRtuYMCAAQMGDJh1MFOFqejzqoWxaNArV/DAgAEDBgwYMLeHyR60GrimBpK6hbBwoQoMGDBgwIABsw6me+BqQ61awKo23NIBDwwYMGDAgAFzG5hsISf6vWyw6v5+9gWfBjwwYMCAAQMGzDqY7oHGD9p8cdlgCQYMGDBgwIDZD9Md7KkWjrLAU8EQDBgwYMCAAfMcmOrFwwdoDgJlg1y74QYGDBgwYMCAuR1Md3WDW7ehVh08OnwRYMCAAQMGDJg1MK/iikJl91UD3FTDDgwYMGDAgAGzD6YavKKBLjo4VG3gVQMeGDBgwIABA+Y5MNUA1b1ANvh1G25gwIABAwYMGDBTAz9Tha/oucINNzBgwIABAwbM18BkG3TdRlk3UH48+YIBAwYMGDBgLoPJXiDbQKs+bzrggQEDBgwYMGCeA9NtXFUHiLoQ3cEjMGDAgAEDBsxeGAsMGDBgwIABs2z9AKDc4juGdJS2AAAAAElFTkSuQmCC">
          </div>
        </div>
      
    
      
        <a class="-mob-share-telegram" title rel="external nofollow noopener noreferrer" href="https://t.me/share/url?url=http://tabris.top/2017-07-18-75270526/&text=[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】 - tabris的博客" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/telegram.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class="prev" href="/2017-07-18-75331107/">
                <p class="title"><i class="fas fa-chevron-left" aria-hidden="true"></i>[原创]第七届福建省赛 【(5+2)/10】</p>
                <p class="content">[原创]第七届福建省赛 【(5+2)/10】
2017-07-18 21:46:10  Tabris_ 阅读数：560

博客爬取于2020-06-14 22:39:36以下为正文
版权声明：本...</p>
              </a>
            
            
              <a class="next" href="/2017-07-17-75267826/">
                <p class="title">[原创]POJ 1741 Tree [点分治入门题]【分治】<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class="content">[原创]POJ 1741 Tree [点分治入门题]【分治】
2017-07-17 20:37:58  Tabris_ 阅读数：375

博客爬取于2020-06-14 22:39:38以下为正...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box reveal comments shadow">
    <section class="article typo">
      <p ct><i class="fas fa-comments"></i> 评论</p>
      
      
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
          </div>
        </section>
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->

  <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.0/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>




  <script>
    window.subData = {
      title: '[原创]SPOJ FTOUR2 - Free tour II  [点分治+启发式合并]【分治】',
      tools: true
    }
  </script>


</div>
<aside class="l_side">
  
  
    
    

<section class="widget blogger shadow desktop mobile">
  <div class="content">
    
      
        <a class="avatar flat-box" href="/about/">
          <img no-lazy src="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg">
        </a>
      
    
    
      <div class="text">
        
          <h2>tabris's blog</h2>
        
        
          <p>Tabris</p>

        
        
          <p><span id="jinrishici-sentence">tabris的博客</span></p>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:tabris.dq@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/tabris233" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

  

  
    
    


  <section class="widget toc-wrapper shadow desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class="name">本文目录</span>
    
  </header>


    <div class="content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#最好去看论文-gt-戳这里"><span class="toc-text">最好去看论文&#x3D;&#x3D;&#x3D;&gt;戳这里</span></a></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js theme="#1BCDFC" autoplay="false" volume="0.7" loop="all" order="list" fixed="false" list-max-height="340px" server="netease" type="playlist" id="3175833810" list-folded="true">
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:tabris.dq@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/tabris233" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="external nofollow noopener noreferrer">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://volantis.js.org/" target="_blank" class="codename" rel="external nofollow noopener noreferrer">Volantis</a>
        作为主题，总访问量为
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class="copyright">
        <p><a href="http://tabris.top">Copyright © 2017-2020 tabris</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href="javascript:void(0)"></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script defer src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  









  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var meta = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick','mail','link'];
  var requiredFields = 'nick,mail'.split(',').filter(function(item){
    return REQUIRED_FIELDS.indexOf(item) > -1
  });
  var valine = new Valine();
  function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  valine.init({
    el: '#valine_container',
    meta: meta,
    
    appId: "XkeYrd6r1FrJXgASPvPJa9Hp-gzGzoHsz",
    appKey: "de9Yfw8ns8xwf6S9eHOj82Wi",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'robohash',
    lang:'zh-cn',
    visitor: 'true',
    highlight: 'true',
    mathJax: 'true',
    enableQQ: 'true',
    requiredFields: requiredFields,
    emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
    emojiMaps: emojiMaps
  })
  </script>





  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>






<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 标准 markdown 描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>




  <script>setLoadingBarProgress(100);</script>
<script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>
</html>
