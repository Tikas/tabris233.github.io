<!DOCTYPE html>
<html>
<head hexo-theme="https://volantis.js.org/#2.6.6">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】 - tabris的博客</title>
  
    <meta name="keywords" content="CSDN,codeforces,数据结构,线段树">
  
  
    <meta name="description" content="[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】
2017-09-21 16:44:50  Tabris_ 阅读数：359

博客爬取于2020-06-14 22:39:27以下为正文
版权声明：本文为Tabris原创文章，未经博主允许...">
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="tabris的博客">
  

  <!-- import meta -->
  
    
      <meta name="theme-color" content="#FFFFFF">
    
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  
  
  <link rel="shortcut icon" type="image/x-icon" sizes="16x16 32x32 48x48 64x64" href="/assets/favicon/favicon.ico">
  <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/favicon/favicon_180.png">
  <link rel="mask-icon" color="#1BC3FB" href="/assets/favicon/favicon_180.png">
  <link rel="manifest" href="/manifest.json">
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">
  <div class="container">
  <div class="wrapper">
    <div class="nav-sub">
      <p class="title"></p>
      <ul class="switcher nav-list-h">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href="javascript:void(0)"></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href="javascript:void(0)"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href="/">
          
          
            <i class="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg"></i>
          
          
            Tabris
          
          
        </a>
      

			<div class="menu navigation">
				<ul class="nav-list-h">
          
          
          
            
            
              <li>
                <a class="flat-box" href="/" id="home">
                  <i class="fas fa-home fa-fw"></i>首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box">
                  <i class="fas fa-book fa-fw"></i>待整理
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="搜索...">
        </form>
      </div>

			<ul class="switcher nav-list-h">
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href="javascript:void(0)"></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href="javascript:void(0)"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href="/" id="home">
                  <i class="fas fa-home fa-fw"></i>首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="flat-box">
                  <i class="fas fa-book fa-fw"></i>待整理
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="flat-box" href="/categories/" id="categories">
                  <i class="fas fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/tags/" id="tags">
                  <i class="fas fa-tags fa-fw"></i>标签
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/archives/" id="archives">
                  <i class="fas fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/friends/" id="friends">
                  <i class="fas fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href="/about/" id="about">
                  <i class="fas fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class="body-wrapper">
      

<div class="l_main">
  

  
    <article id="post" class="post white-box reveal shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class="meta">
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h1 class="title">
    <a href="/2017-09-21-78053974/">
      [原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】
    </a>
  </h1>


        
        <div class="new-meta-box">
          
            
          
            
              
<div class="new-meta-item author">
  <a href rel="nofollow">
    <img src>
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class="new-meta-item category">
    <a href="/categories/csdn/codeforces/%E6%80%9D%E7%BB%B4/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>CSDN/codeforces/思维/数据结构</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2017年9月21日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  <div class="new-meta-item wordcount">
    <a class="notlink">
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：1.7k字</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class="notlink">
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：9分钟</p>
    </a>
  </div>


            
          
            
              
  <div class="new-meta-item browse valine">
    <a class="notlink">
      <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
      
      <span id="/2017-09-21-78053974/" class="leancloud_visitors" data-flag-title="[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】">
      <p>
        <span class="leancloud-visitors-count"></span>
      </p>
      </span>
    </a>
  </div>


            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <p>[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】</p>
<p>2017-09-21 16:44:50  <a href="https://me.csdn.net/qq_33184171" target="_blank" rel="external nofollow noopener noreferrer">Tabris_</a> 阅读数：359</p>
<hr>
<p>博客爬取于<code>2020-06-14 22:39:27</code><br><strong><em>以下为正文</em></strong></p>
<p>版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。<br><a href="https://blog.csdn.net/qq_33184171/article/details/78053974" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/qq_33184171/article/details/78053974</a></p>
<a id="more"></a>

<hr>
<p>题目链接：<a href="http://codeforces.com/problemset/problem/794/F" target="_blank" rel="external nofollow noopener noreferrer">http://codeforces.com/problemset/problem/794/F</a><br>——————————————————————————————————————<br>F. Leha and security system<br>time limit per test2 seconds<br>memory limit per test512 megabytes<br>inputstandard input<br>outputstandard output<br>Bankopolis, the city you already know, finally got a new bank opened! Unfortunately, its security system is not yet working fine... Meanwhile hacker Leha arrived in Bankopolis and decided to test the system!</p>
<p>Bank has n cells for clients&#39; money. A sequence from n numbers a1, a2, ..., an describes the amount of money each client has. Leha wants to make requests to the database of the bank, finding out the total amount of money on some subsegments of the sequence and changing values of the sequence on some subsegments. Using a bug in the system, Leha can requests two types of queries to the database:</p>
<p>1 l r x y denoting that Leha changes each digit x to digit y in each element of sequence ai, for which l ≤ i ≤ r is holds. For example, if we change in number 11984381 digit 8 to 4, we get 11944341. It&#39;s worth noting that Leha, in order to stay in the shadow, never changes digits in the database to 0, i.e. y ≠ 0.<br>2 l r denoting that Leha asks to calculate and print the sum of such elements of sequence ai, for which l ≤ i ≤ r holds.<br>As Leha is a white-hat hacker, he don&#39;t want to test this vulnerability on a real database. You are to write a similar database for Leha to test.</p>
<p>Input<br>The first line of input contains two integers n and q (1 ≤ n ≤ 105, 1 ≤ q ≤ 105) denoting amount of cells in the bank and total amount of queries respectively.</p>
<p>The following line contains n integers a1, a2, ..., an (1 ≤ ai &lt; 109) denoting the amount of money in each cell initially. These integers do not contain leading zeros.</p>
<p>Each of the following q lines has one of the formats:</p>
<p>1 l r x y (1 ≤ l ≤ r ≤ n, 0 ≤ x ≤ 9, 1 ≤ y ≤ 9), denoting Leha asks to change each digit x on digit y for each element ai of the sequence for which l ≤ i ≤ r holds;<br>2 l r (1 ≤ l ≤ r ≤ n), denoting you have to calculate and print the sum of elements ai for which l ≤ i ≤ r holds.<br>Output<br>For each second type query print a single number denoting the required sum.</p>
<p>Examples<br>input<br>5 5<br>38 43 4 12 70<br>1 1 3 4 8<br>2 2 4<br>1 4 5 0 8<br>1 2 5 8 7<br>2 1 5<br>output<br>103<br>207<br>input<br>5 5<br>25 36 39 40 899<br>1 1 3 2 7<br>2 1 2<br>1 3 5 9 1<br>1 4 4 0 9<br>2 1 5<br>output<br>111<br>1002<br>Note<br>Let&#39;s look at the example testcase.</p>
<p>Initially the sequence is [38, 43, 4, 12, 70].</p>
<p>After the first change each digit equal to 4 becomes 8 for each element with index in interval [1; 3]. Thus, the new sequence is [38, 83, 8, 12, 70].</p>
<p>The answer for the first sum&#39;s query is the sum in the interval [2; 4], which equal 83 + 8 + 12 = 103, so the answer to this query is 103.</p>
<p>The sequence becomes [38, 83, 8, 12, 78] after the second change and [38, 73, 7, 12, 77] after the third.</p>
<p>The answer for the second sum&#39;s query is 38 + 73 + 7 + 12 + 77 = 207.<br>——————————————————————————————————————<br>题目大意:</p>
<p>一个长度为n的序列 ，有两种操作，</p>
<ol>
<li>将[l, r]上所有数中 数位为x的都改为y</li>
<li>求[l, r]上所有数的和</li>
</ol>
<hr>
<p>解题思路：</p>
<p>还是考虑直接的线段树维护，<br>每个节点维护10个信息，分别是数位为0~9的和，同时维护延迟标记</p>
<p>求和部分略，</p>
<p>对于数位修改，最大的问题就是考虑 如何维护lazy了，</p>
<p>这里维护的lazy同样有10个，lazy[i]表示的是接下来的数中数位为i的要变成数位lazy[i]</p>
<p>那么问题就是标记下传怎么搞了</p>
<p>和普通的标记下传相比 较为复杂,但也无非是把左右儿子的值先改过来 ,再把lazy合并过去,</p>
<p>还是看代码 比较好理解</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这是对左儿子进行pushdown的</span><br><span class="line">    for(int i=0;i&lt;10;i++)vis<span class="comment">[i]</span>=lazy<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[i]</span>,sum2<span class="comment">[i]</span>=sum<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[i]</span>;  // 找两个临时变量代替左儿子的信息</span><br><span class="line">    for(int i=0;i&lt;10;i++)if(lazy<span class="comment">[rt]</span><span class="comment">[i]</span>!=i)&#123;                           //</span><br><span class="line">        for(int j=0;j&lt;10;j++)if(lazy<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[j]</span>==i) vis<span class="comment">[j]</span>=lazy<span class="comment">[rt]</span><span class="comment">[i]</span>; //数位变化</span><br><span class="line">        sum2<span class="comment">[lazy<span class="comment">[rt]</span><span class="comment">[i]</span>]</span>+=sum<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[i]</span>;                              // 变过去的就要加上值</span><br><span class="line">        sum2<span class="comment">[i]</span>-=sum<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[i]</span>;                                        // 因为可能是变过来在变过去,所以不能直接赋0</span><br><span class="line">    &#125;</span><br><span class="line">    for(int i=0;i&lt;10;i++) sum<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[i]</span>=sum2<span class="comment">[i]</span>,lazy<span class="comment">[rt&lt;&lt;1]</span><span class="comment">[i]</span>=vis<span class="comment">[i]</span>;</span><br></pre></td></tr></table></figure>


<hr>
<p>附本题代码<br>——————————————————————————————————————</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"># include &lt;bits/stdc++.h&gt;</span><br><span class="line">typedef long long int LL;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">const int N = <span class="number">1e5</span>+<span class="number">7</span>;</span><br><span class="line"><span class="comment">/*****************************************/</span></span><br><span class="line">LL sum[N&lt;&lt;<span class="number">2</span>][<span class="number">11</span>],sum2[<span class="number">11</span>],a[N];</span><br><span class="line">int lazy[N&lt;&lt;<span class="number">2</span>][<span class="number">11</span>],vis[<span class="number">11</span>];</span><br><span class="line"></span><br><span class="line">void pushdown(int rt)&#123;</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)vis[i]=lazy[rt&lt;&lt;<span class="number">1</span>][i],sum2[i]=sum[rt&lt;&lt;<span class="number">1</span>][i];</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)if(lazy[rt][i]!=i)&#123;</span><br><span class="line">        for(int j=<span class="number">0</span>;j&lt;<span class="number">10</span>;j++)if(lazy[rt&lt;&lt;<span class="number">1</span>][j]==i) vis[j]=lazy[rt][i];</span><br><span class="line">        sum2[lazy[rt][i]]+=sum[rt&lt;&lt;<span class="number">1</span>][i];</span><br><span class="line">        sum2[i]-=sum[rt&lt;&lt;<span class="number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) sum[rt&lt;&lt;<span class="number">1</span>][i]=sum2[i],lazy[rt&lt;&lt;<span class="number">1</span>][i]=vis[i];</span><br><span class="line"></span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) vis[i]=lazy[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i],sum2[i]=sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i];</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)if(lazy[rt][i]!=i)&#123;</span><br><span class="line">        for(int j=<span class="number">0</span>;j&lt;<span class="number">10</span>;j++)if(lazy[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][j]==i) vis[j]=lazy[rt][i];</span><br><span class="line">        sum2[lazy[rt][i]]+=sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i];</span><br><span class="line">        sum2[i]-=sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i]=sum2[i],lazy[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i]=vis[i];</span><br><span class="line"></span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) lazy[rt][i] = i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void pushup(int rt)&#123;</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) sum[rt][i]=sum[rt&lt;&lt;<span class="number">1</span>][i]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void build(int rt,int l,int r)&#123;</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) sum[rt][i]=<span class="number">0</span>;</span><br><span class="line">    for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)lazy[rt][i]=i;</span><br><span class="line">    if(l==r)&#123;</span><br><span class="line">        for(LL t=<span class="number">1</span>;a[l];a[l]/=<span class="number">10</span>,t*=<span class="number">10</span>)</span><br><span class="line">            sum[rt][a[l]%<span class="number">10</span>]+=t;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    int m = r+l &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>  ,l  ,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void update(int rt,int l,int r,int L,int R,int x,int y)&#123;</span><br><span class="line">    if(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">        for(int i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)if(lazy[rt][i]==x)&#123;</span><br><span class="line">            sum[rt][y]+=sum[rt][x];</span><br><span class="line">            sum[rt][x]=<span class="number">0</span>;</span><br><span class="line">            lazy[rt][i]=y;</span><br><span class="line">        &#125;</span><br><span class="line">        return ;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt);</span><br><span class="line">    int m = r+l &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    if(L&lt;=m) update(rt&lt;&lt;<span class="number">1</span>  ,l  ,m,L,R,x,y);</span><br><span class="line">    if(R&gt; m) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,L,R,x,y);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL query(int rt,int l,int r,int L,int R)&#123;</span><br><span class="line">    if(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">        LL ans = <span class="number">0</span>;</span><br><span class="line">        for(LL i=<span class="number">1</span>;i&lt;<span class="number">10</span>;i++) ans+=sum[rt][i]*i;</span><br><span class="line">        return ans;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt);</span><br><span class="line">    int m = r+l &gt;&gt; <span class="number">1</span>;LL ans = <span class="number">0</span>;</span><br><span class="line">    if(L&lt;=m) ans += query(rt&lt;&lt;<span class="number">1</span>  ,l  ,m,L,R);</span><br><span class="line">    if(R&gt; m) ans += query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,L,R);</span><br><span class="line">    pushup(rt);</span><br><span class="line">    return ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int n,m;</span><br><span class="line">int main()&#123;</span><br><span class="line">    while(~scanf(<span class="string">"%d%d"</span>,&amp;n,&amp;m))&#123;</span><br><span class="line">        for(int i=<span class="number">1</span>;i&lt;=n;i++) scanf(<span class="string">"%lld"</span>,&amp;a[i]);</span><br><span class="line">        build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        int op,l,r,x,y;</span><br><span class="line">        for(int i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            scanf(<span class="string">"%d%d%d"</span>,&amp;op,&amp;l,&amp;r);</span><br><span class="line">            if(<span class="number">1</span>==op)&#123;</span><br><span class="line">                scanf(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line">                if(x==y) continue;</span><br><span class="line">                update(<span class="number">1</span>,<span class="number">1</span>,n,l,r,x,y);</span><br><span class="line">            &#125;</span><br><span class="line">            else printf(<span class="string">"%lld<span class="subst">\n</span>"</span>,query(<span class="number">1</span>,<span class="number">1</span>,n,l,r));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
            <div class="article_footer">
              
                
  
    
    

<section class="widget copyright  desktop mobile">
  <div class="content">
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href="http://tabris.top/2017-09-21-78053974/">http://tabris.top/2017-09-21-78053974/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class="content article-entry">
    
      
        <div class="fancybox"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/qrcode/wechat.jpg" height="64px"></div>
      
    
      
        <div class="fancybox"><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/qrcode/alipay.jpg" height="64px"></div>
      
    
  </div>
</section>

  


              
            </div>
          
        </div>
        
          


  <section class="meta" id="footer-meta">
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-06-19T13:14:24+00:00">
  <a class="notlink">
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020年6月19日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/csdn/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>CSDN</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/codeforces/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>codeforces</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>数据结构</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>线段树</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title rel="external nofollow noopener noreferrer" href="http://connect.qq.com/widget/shareqq/index.html?url=http://tabris.top/2017-09-21-78053974/&title=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】 - tabris的博客&summary=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】
2017-09-21 16:44:50  Tabris_ 阅读数：359

博客爬取于2020-06-14 22:39:27以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/78053974" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title rel="external nofollow noopener noreferrer" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://tabris.top/2017-09-21-78053974/&title=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】 - tabris的博客&summary=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】
2017-09-21 16:44:50  Tabris_ 阅读数：359

博客爬取于2020-06-14 22:39:27以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/78053974" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title rel="external nofollow noopener noreferrer" href="http://service.weibo.com/share/share.php?url=http://tabris.top/2017-09-21-78053974/&title=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】 - tabris的博客&summary=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】
2017-09-21 16:44:50  Tabris_ 阅读数：359

博客爬取于2020-06-14 22:39:27以下为正文
版权声明：本文为Tabris原创文章，未经博主允许不得私自转载。https://blog.csdn.net/qq_33184171/article/details/78053974" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
      
        
        <div class="hoverbox">
          <a><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/wechat.png"></a>
          <div class="target">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAAAAACi5bZQAAAC/UlEQVR42u3aSXLDMAwEQP3/08kDEpWwSSXYzZs3mmhdpgAeP9a/60AABgwYMGDArIE5iuvPhifvn/3P1e+r+3XrAQMGDBgwYMDsgwkHoIvCop9nwaPn7NYDBgwYMGDAgNkLcxmAgq+j+1QDZPZ84e+DAQMGDBgwYL4OpltgOIANPSgwYMCAAQMGDJho8Mo2vKYHd2DAgAEDBgyYz4dJD6iSDaTpQJgNjI9NIsGAAQMGDBgwj8Fk13Qj6e7GVLgeMGDAgAEDBswamO6KBrpsI6s7qCvXAwYMGDBgwIBZAzPdUMoCTX2ve34wYMCAAQMGzF6Y7OArCjO1T7RhVgUDAwYMGDBgwOyDiW4wfXEnun8XPns+MGDAgAEDBsxemOmG0F0Dt+lgBwYMGDBgwIDZBzPW4BkuNBtAq40tMGDAgAEDBsxemO5g7Op19mJSdQDXhQUDBgwYMGDA7Ie5q8HUDYBTF4bKAQ8MGDBgwIAB83qYqYKrF4+iQWwqiIIBAwYMGDBg9sJ0g1R3ENe9eFQ912n9YMCAAQMGDJg1MNECqoV1G1PZgWAbFAwYMGDAgAGzBiZaSDkwNRtW0wEz3agCAwYMGDBgwLwWphuopvaZblBlHygYMGDAgAEDZi/MdEMpe+C7/i/bOAMDBgwYMGDA7IGJNp6ywawb9KpBMg1RHbiBAQMGDBgwYF4DE90gO8CqNqSqA7Nu4AMDBgwYMGDAfC7M9OBsKriNDQTBgAEDBgwYMGth7rrgXG1wVS8GjQ3cwIABAwYMGDCvhemuqUFbNehVLx6dPggwYMCAAQMGzBqYo7iycN2B23QgDCdfMGDAgAEDBszrYbqFTkN3B3dgwIABAwYMmO+DmQpgU42vauMq+wDAgAEDBgwYMN8L0w140cK7DbH0wA0MGDBgwIAB8/Ew3WDXDXjV3z/WqAIDBgwYMGDA3A6THbhlv9dtQFUD3uOTSDBgwIABAwbMYzDlxk7x/SmI7sUjMGDAgAEDBsxeGAsMGDBgwIABs2z9AkHVX+iRFB6MAAAAAElFTkSuQmCC">
          </div>
        </div>
      
    
      
        <a class="-mob-share-telegram" title rel="external nofollow noopener noreferrer" href="https://t.me/share/url?url=http://tabris.top/2017-09-21-78053974/&text=[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】 - tabris的博客" target="_blank">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/telegram.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class="prev" href="/2017-10-08-78175188/">
                <p class="title"><i class="fas fa-chevron-left" aria-hidden="true"></i>[原创]vijos P2026 几乎奇偶等和数 [数位dp]【动态规划】</p>
                <p class="content">[原创]vijos P2026 几乎奇偶等和数 [数位dp]【动态规划】
2017-10-08 15:24:34  Tabris_ 阅读数：485

博客爬取于2020-06-14 22:39:...</p>
              </a>
            
            
              <a class="next" href="/2017-08-18-77349012/">
                <p class="title">[原创]hdu 6134 Battlestation Operational [反演]【数学】<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class="content">[原创]hdu 6134 Battlestation Operational [反演]【数学】
2017-08-18 01:01:18  Tabris_ 阅读数：429

博客爬取于2020-0...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box reveal comments shadow">
    <section class="article typo">
      <p ct><i class="fas fa-comments"></i> 评论</p>
      
      
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
          </div>
        </section>
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->

  <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.0/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>




  <script>
    window.subData = {
      title: '[原创]Codeforces 794F - Leha and security system [线段树-区间更新]【数据结构】',
      tools: true
    }
  </script>


</div>
<aside class="l_side">
  
  
    
    

<section class="widget blogger shadow desktop mobile">
  <div class="content">
    
      
        <a class="avatar flat-box" href="/about/">
          <img no-lazy src="https://cdn.jsdelivr.net/gh/tabris233/cdn-assets/avatar/avatar.jpg">
        </a>
      
    
    
      <div class="text">
        
          <h2>tabris's blog</h2>
        
        
          <p>Tabris</p>

        
        
          <p><span id="jinrishici-sentence">tabris的博客</span></p>
          <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:tabris.dq@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/tabris233" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

  

  
    
    



  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js theme="#1BCDFC" autoplay="false" volume="0.7" loop="all" order="list" fixed="false" list-max-height="340px" server="netease" type="playlist" id="3175833810" list-folded="true">
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:tabris.dq@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/tabris233" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382" class="social fas fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="external nofollow noopener noreferrer">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://volantis.js.org/" target="_blank" class="codename" rel="external nofollow noopener noreferrer">Volantis</a>
        作为主题，总访问量为
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class="copyright">
        <p><a href="http://tabris.top">Copyright © 2017-2020 tabris</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href="javascript:void(0)"></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script defer src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  









  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var meta = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick','mail','link'];
  var requiredFields = 'nick,mail'.split(',').filter(function(item){
    return REQUIRED_FIELDS.indexOf(item) > -1
  });
  var valine = new Valine();
  function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  valine.init({
    el: '#valine_container',
    meta: meta,
    
    appId: "XkeYrd6r1FrJXgASPvPJa9Hp-gzGzoHsz",
    appKey: "de9Yfw8ns8xwf6S9eHOj82Wi",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'robohash',
    lang:'zh-cn',
    visitor: 'true',
    highlight: 'true',
    mathJax: 'true',
    enableQQ: 'true',
    requiredFields: requiredFields,
    emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
    emojiMaps: emojiMaps
  })
  </script>





  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>






<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 标准 markdown 描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>




  <script>setLoadingBarProgress(100);</script>
<script>!function(e){var c=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){for(var r=0;r<c.length;r++)t=c[r],0<=(n=t.getBoundingClientRect()).bottom&&0<=n.left&&n.top<=(e.innerHeight||document.documentElement.clientHeight)&&function(){var t,n,e,i,o=c[r];t=o,n=function(){c=c.filter(function(t){return o!==t})},e=new Image,i=t.getAttribute("data-original"),e.onload=function(){t.src=i,n&&n()},e.src=i}();var t,n}i(),e.addEventListener("scroll",function(){var t,n;t=i,n=e,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(n)},500)})}(this);</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script></body>
</html>
